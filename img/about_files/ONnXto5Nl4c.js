if (self.CavalryLogger) { CavalryLogger.start_js(["8NPCb"]); }

__d('PhotoPermalinkTagger',['Arbiter','Event','PhotoPermalink','PhotoTagger','$'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('PhotoTagger'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,c('PhotoPermalink').getInstance(),true);this.photoData=k;}j.prototype.setupHandlers=function(){'use strict';var k=c('$')('imagestage'),l=c('$')('fbPhotoPageTagBoxes');this.handlers=[c('Event').listen(this.clickState,'click',this.addTag.bind(this)),c('Event').listen(k,'click',this.addTag.bind(this)),c('Event').listen(l,'click',this.addTag.bind(this)),c('Event').listen(this.addTagLink,'click',this.checkActions.bind(this)),c('Event').listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[c('Arbiter').subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),c('Arbiter').subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),c('Arbiter').subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};j.prototype.setDataForTokenizer=function(){'use strict';this.tokenizer.setup(null,this.photoData);return this;};Object.assign(j.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});f.exports=j;}),null);
__d('legacy:PhotoPermalinkTagger',['PhotoPermalinkTagger'],(function a(b,c,d,e,f,g){b.PhotoPermalinkTagger=c('PhotoPermalinkTagger');}),3);
__d('legacy:fb-photos-permalink-js',['PhotoPermalink'],(function a(b,c,d,e,f,g){b.PhotoPermalink=c('PhotoPermalink');}),3);
__d('TagToken',['DOM','Token'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('Token'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k,'tag');}j.prototype.createElement=function(){'use strict';var k=this.isFreeform(),l=c('DOM').create('span',{className:'separator'},', '),m=c('DOM').create(k?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!k)m.href=this.getInfo().path;return c('DOM').create('span',{className:'tagItem'},[l,m]);};f.exports=j;}),null);
__d('TagTokenizer',['fbt','Arbiter','CSS','DOM','Parent','TagToken','Tokenizer','createObjectFrom','ge','getElementText'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('Tokenizer'));j=i&&i.prototype;function k(l,m,n,o,p){'use strict';j.constructor.call(this,n,o,p);c('Arbiter').subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),c('Arbiter').SUBSCRIBE_NEW);this.appphoto=m;c('Arbiter').subscribe(l.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),c('Arbiter').SUBSCRIBE_NEW);}k.prototype.setup=function(l,m){'use strict';this.appphoto=m.byapp;this.byowner=m.isowner;return this.reset();};k.prototype.reset=function(){'use strict';var l=this.getTokenElements().map(this.getTokenDataFromTag,this);this.withTagKeys={};var m=this.getWithTagTokenElements().map(function(n){return this._tokenKey(this.getTokenDataFromTag(n));}.bind(this));this.withTagKeys=c('createObjectFrom')(m);return j.reset.call(this,l);};k.prototype.processEvents=function(event,l,m){'use strict';if(c('Parent').byClass(l,'remove')){var n=this.getTokenFromElement(m);n=this.addTokenData(n,l);this.removeToken(n);event.kill();}};k.prototype.insertToken=function(l){'use strict';return null;};k.prototype.removeToken=function(l){'use strict';if(this.appphoto){return this.replaceToken(l);}else{this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});}return null;};k.prototype.addTokenData=function(l,m){'use strict';if(c('Parent').byClass(m,'blockuser'))l.blockUser=true;return l;};k.prototype.getTokenDataFromTag=function(l){'use strict';return {uid:c('DOM').find(l,'input').value,text:c('getElementText')(c('DOM').find(l,'.taggee'))};};k.prototype.getTokenElementFromTarget=function(l){'use strict';return c('Parent').byClass(l,'tagItem');};k.prototype.getTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements,this);};k.prototype.getWithTagTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.withTagItem');};k.prototype.filterNonTokenElements=function(l){'use strict';return !c('CSS').hasClass(l,'markasspam')&&!c('CSS').hasClass(l,'reported')&&!c('CSS').hasClass(l,'withTagItem');};k.prototype.createToken=function(l,m){'use strict';var n=this.getToken(this._tokenKey(l));n=n||new (c('TagToken'))(l);m&&n.setElement(m);return n;};k.prototype.updateTokenareaVisibility=function(){'use strict';var l=this.getTokenElements().filter(function(o){return c('CSS').shown(o);}),m=this.getWithTagTokenElements(),n=c('DOM').scry(this.tokenarea,'span.ogTagItem');c('CSS').conditionShow(this.tokenarea,l.length!==0||m.length!==0||n.length!==0);};k.prototype.replaceToken=function(l){'use strict';if(!l)return;var m=this.tokens.indexOf(l);if(m<0)return;this.tokens.splice(this.tokens.indexOf(l),1);delete this.unique[this._tokenKey(l.getInfo())];var n=c('ge')('tagspam'+l.getValue());n&&c('DOM').remove(n);var o=[' [',h._("Znacznik usuni\u0119ty."),' '];o.push(c('DOM').create('a',{onclick:this.markAsSpam.bind(this,l.getValue())},h._("Oznacz tag jako spam")));o.push('] ');var p=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+l.getValue()},o);c('DOM').replace(l.getElement(),p);this.updateTokenarea();this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});};k.prototype.markAsSpam=function(l){'use strict';var m=c('ge')('tagspam'+l),n=[' [',h._("Znacznik zg\u0142oszony"),'] '],o=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+l},n);c('DOM').replace(m,o);this.inform('markTagAsSpam',l);};f.exports=k;}),null);