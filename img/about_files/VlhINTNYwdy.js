if (self.CavalryLogger) { CavalryLogger.start_js(["v9c9D"]); }

__d('SendAPIDialogButton',['Button'],(function a(b,c,d,e,f,g){f.exports={monitor:function h(i){var j=document.getElementsByName('publish')[0],k='TypeaheadBehaviors';Object.assign(window[k]||(window[k]={}),{SendAPIDialogButtonActivate:function l(m){m.subscribe('select',function(){c('Button').setEnabled(j,1);});m.subscribe('blur',function(){var n=i.getTokenValues();c('Button').setEnabled(j,n&&n.length);});}});}};}),null);
__d('LitestandLinkHider',['DataStore','DOMQuery','Event','Parent','UserAgent_DEPRECATED'],(function a(b,c,d,e,f,g){'use strict';function h(event){var j=event.getTarget(),k=c('Parent').byTag(j,'a');if(!k)return;if(event.type==='mouseover'){c('DataStore').set(k,'href',k.href);k.removeAttribute('href');}else{k.href=c('DataStore').get(k,'href')||k.href;if(event.type==='mouseout')c('DataStore').remove(k,'href');}}var i={hideLinks:function j(k){if(c('UserAgent_DEPRECATED').chrome()||c('UserAgent_DEPRECATED').ie()>=9||c('UserAgent_DEPRECATED').opera())c('Event').listen(k,{mouseover:h,mouseout:h,mousedown:h});},removeAllHrefs:function j(k){var l=arguments.length<=1||arguments[1]===undefined?null:arguments[1],m=c('DOMQuery').scry(k,'a');m.forEach(function(n){if(l&&l.length&&l.some(function(o){return n.hasAttribute(o);}))return;n.removeAttribute('href');n.removeAttribute('ajaxify');n.removeAttribute('rel');n.setAttribute('tabindex',0);});},removeClickable:function j(k,l){i.removeAllHrefs(k);var m=c('DOMQuery').scry(k,'.'+l+' a');m.forEach(function(n){n.removeAttribute('onclick');n.removeAttribute('onmouseover');});}};f.exports=i;}),null);
__d('PhotoAlbumAudienceInput',['Arbiter','CSS','DOM','Event'],(function a(b,c,d,e,f,g){function h(i,j,k,l,m){'use strict';this.$PhotoAlbumAudienceInput1=i;if(j){this.$PhotoAlbumAudienceInput2=j;this.$PhotoAlbumAudienceInput3=k;this.$PhotoAlbumAudienceInput4=l;this.$PhotoAlbumAudienceInput5=m;c('Arbiter').subscribe('Tokenizer/init',this.$PhotoAlbumAudienceInput6.bind(this));c('Event').listen(this.$PhotoAlbumAudienceInput4,'click',this.$PhotoAlbumAudienceInput7.bind(this));}}h.prototype.removeHiddenPrivacyWidget=function(){'use strict';[this.$PhotoAlbumAudienceInput1,this.$PhotoAlbumAudienceInput2,this.$PhotoAlbumAudienceInput5].forEach(function(i){if(i&&c('CSS').hasClass(i,'hidden_elem'))c('DOM').remove(i);});};h.prototype.$PhotoAlbumAudienceInput7=function(){'use strict';this.$PhotoAlbumAudienceInput8.removeAllTokens();this.$PhotoAlbumAudienceInput9(null,null);};h.prototype.$PhotoAlbumAudienceInput6=function(i,j){'use strict';if(this.$PhotoAlbumAudienceInput8||this.$PhotoAlbumAudienceInput3!=j.element)return;this.$PhotoAlbumAudienceInput8=j;this.$PhotoAlbumAudienceInput9(null,null);c('Arbiter').subscribe('Form/change',this.$PhotoAlbumAudienceInput9.bind(this));};h.prototype.$PhotoAlbumAudienceInput9=function(i,j){'use strict';var k=this.$PhotoAlbumAudienceInput8.getTokens().length>0;this.$PhotoAlbumAudienceInput10(k);};h.prototype.$PhotoAlbumAudienceInput10=function(i){'use strict';c('CSS').conditionShow(this.$PhotoAlbumAudienceInput2,i);c('CSS').conditionShow(this.$PhotoAlbumAudienceInput1,!i);this.$PhotoAlbumAudienceInput5&&c('CSS').conditionShow(this.$PhotoAlbumAudienceInput5,i);};f.exports=h;}),null);
__d('PhotoAlbumPlacesTypeahead',['Arbiter'],(function a(b,c,d,e,f,g){function h(i){'use strict';if(!i)return;if(i.getCore().getHiddenValue()){var j={uid:i.getCore().getHiddenValue(),text:i.getCore().getValue()};c('Arbiter').inform('PhotoAlbumPlacesTypeahead.EXIST_PLACE',j);}i.subscribe('select',function(k,l){c('Arbiter').inform('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',l.selected);}.bind(this));i.subscribe('reset',function(){if(!i.getCore().getHiddenValue())c('Arbiter').inform('PhotoAlbumPlacesTypeahead.RESET_PLACE');}.bind(this));i.subscribe('focus',function(){c('Arbiter').inform('PhotoAlbumPlacesTypeahead.FOCUSED');}.bind(this));this._initialized=true;}h.prototype.init=function(i){'use strict';if(this._initialized)return;h.call(this,i);};f.exports=h;}),null);
__d('PersistentAlbumDataStore',['WebStorage'],(function a(b,c,d,e,f,g){var h='fb_album_recovery',i=7*60*60*24,j={_storageExists:true,_initializeWebStorage:function k(){var l=c('WebStorage').getLocalStorage();if(!l){j._storageExists=false;return;}if(!l.getItem(h))l.setItem(h,JSON.stringify({}));},_getAlbumsObject:function k(){if(!j._storageExists)return {};j._initializeWebStorage();return JSON.parse(c('WebStorage').getLocalStorage().getItem(h));},_setAlbumsObject:function k(l){if(!j._storageExists)return;j._initializeWebStorage();c('WebStorage').getLocalStorage().setItem(h,JSON.stringify(l));},_getLocalStorageByAlbum:function k(l){return (j._getAlbumsObject()[l]||j.createAlbum(l));},_setLocalStorageByAlbum:function k(l,m){var n=j._getAlbumsObject();n[l]=m;j._setAlbumsObject(n);},createAlbum:function k(l){var m={privacy:null,tags:{},created_at:Date.now()};j._setLocalStorageByAlbum(l,m);return m;},deleteAlbum:function k(l){var m=j._getAlbumsObject();delete m[l];j._setAlbumsObject(m);},getAlbumPrivacy:function k(l){return j._getLocalStorageByAlbum(l).privacy;},setAlbumPrivacy:function k(l,m){var n=j._getLocalStorageByAlbum(l);n.privacy=m;j._setLocalStorageByAlbum(l,n);},saveTag:function k(l,m,n){var o=j._getLocalStorageByAlbum(l);if(!o.tags[m])o.tags[m]=[];n.recovered=true;o.tags[m].push(n);j._setLocalStorageByAlbum(l,o);},removeTag:function k(l,m,n){var o=j._getLocalStorageByAlbum(l),p=o.tags[m]||[];for(var q=0;q<p.length;q++)if(p[q].subject===n||p[q].name===n){p.splice(q,1);break;}o.tags[m]=p;j._setLocalStorageByAlbum(l,o);},getTags:function k(l,m){return (j._getLocalStorageByAlbum(l).tags[m]||[]);},deleteExpiredAlbums:function k(){var l=j._getAlbumsObject();for(var m in l){var n=l[m];if(Date.now()-n.created_at>i*1000)j.deleteAlbum(m);}}};f.exports=j;}),null);
__d('PhotoBulkEditTagger',['csx','Arbiter','AsyncRequest','CSS','DOM','DOMQuery','Event','FaceboxSourceConstants','Parent','PersistentAlbumDataStore','PhotosConst','PhotosTaggingWaterfall','PhotoTagger','PhotoTagStore','SubscriptionsHandler','Vector','$','ge'],(function a(b,c,d,e,f,g,h){var i,j,k=60;i=babelHelpers.inherits(l,c('PhotoTagger'));j=i&&i.prototype;function l(m,n,o,p){'use strict';j.constructor.call(this,m);this.editor=m;this.faceboxes=[];this._qn=p.qn;this.tokenizer=o;this.editor.registerTagger(this);this.typeahead=o.getTypeahead();this.handlers=new (c('SubscriptionsHandler'))();this.root=this.editor.getRoot();this.tagger=n;this.hideNewTagTimer=null;this.photoKey=null;this._needTaggingData=true;this._currentRecognition={box:null,isTagged:false,suggestion:null};this._hoverState=false;this._tagging=false;this.setupHandlers();this._sendWaterfallLogSignal(c('PhotosTaggingWaterfall').BEGIN);this.fetchTaggingSuggestions();this.setTagAccumulator(p.bulkSaveTags);this.setNeedTaggingData(p.needTaggingData);this.version=c('PhotosConst').BULK_EDITOR;c('Event').listen(this.root,'mousemove',function(event){var q=event.getTarget();if(this._hoverState&&!(c('Parent').byClass(q,'faceBox')||c('Parent').byClass(q,'tagPointer')||c('Parent').byClass(q,'arrow')||c('Parent').byClass(q,'faceboxSuggestion'))){this.removeSuggestionFromTagger();this.hideTagger();}}.bind(this));}l.prototype.setupUserActionLogging=function(){'use strict';return null;};l.prototype.logUserActionEvent=function(m){'use strict';return null;};l.prototype.addFaceboxes=function(m){'use strict';this.faceboxes=c('DOMQuery').scry(m.parentNode,'.faceBox');this.faceboxes.sort(function(q,r){return q.offsetLeft===r.offsetLeft?q.offsetTop-r.offsetTop:q.offsetLeft-r.offsetLeft;});var n=c('Parent').byClass(m,'editablePhoto'),o=c('PhotoTagStore').getInstance().getPhotoTags(n.getAttribute('data-photoid')),p=[];Object.keys(o).forEach(function(q){if(o[q].fbid)p[o[q].fbid]=true;});this.faceboxes.forEach(function(q){var r=this.getFaceboxSuggestionFromFaceboxElem(q),s=q.getAttribute('data-faceboxid');if(r&&o[r.getAttribute('data-id')]||p[s]){c('DOM').remove(q);return;}var t={image:m,facebox:q};c('Event').listen(q,'mouseenter',this._mouseOverFacebox.bind(this,t));}.bind(this));};l.prototype.saveTag=function(m,n,o){'use strict';if(!n.info.recovered){j.saveTag.call(this,m,n,o);var p=this.getTaggingDataForSave(n,o);c('PersistentAlbumDataStore').saveTag(this.photoData.albumFBID,this.photoData.fbid,p);}c('Arbiter').inform('PhotoBulkEditTagger.TAG_SAVED',{editor:this.root,fbid:this.photoData.fbid});};l.prototype.recoverPhoto=function(m){'use strict';this.setupPhotoDataForTarget(m.getRoot());var n=c('PersistentAlbumDataStore').getTags(this.photoData.albumFBID,this.photoData.fbid);n.forEach(function(o){var p=this.tokenizer.createToken({uid:o.subject?o.subject:o.name,text:o.name,suggestion:o.from_facebox,freeform:o.subject==='',recovered:true});this.tokenizer.addToken(p);c('PhotoTagStore').getInstance().storeTagWithOptions(this.photoData.fbid,o.subject,o.x,o.y,o);}.bind(this));};l.prototype.setNeedTaggingData=function(m){'use strict';this._needTaggingData=m;return this;};l.prototype.setTagAccumulator=function(m){'use strict';j.setTagAccumulator.call(this,m);return this;};l.prototype.needTaggingData=function(){'use strict';return this._needTaggingData;};l.prototype.setupHandlers=function(){'use strict';c('Event').listen(this.root,'click',this.clickHandler.bind(this));this.tokenizer.subscribe(['addToken','removeToken'],this.handleTokenAction.bind(this));this.tokenizer.subscribe('switchTarget',this.switchPhoto.bind(this));this.tokenizer.subscribe('initialized',this.editor._recoverPhotos.bind(this.editor));c('Arbiter').subscribe('PhotoBulkEditTagger.DATA_SOURCE_READY',this.useTaggingDataSource.bind(this));c('Arbiter').subscribe(this.editor.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'),this.hideTagger.bind(this));};l.prototype.hideTagger=function(){'use strict';j.hideTagger.apply(this,arguments);if(this._currentRecognition.box&&!this._currentRecognition.isTagged)c('CSS').show(this._currentRecognition.box);this._tagging=false;this._hoverState=false;this._currentRecognition.box=null;this._currentRecognition.isTagged=false;this._currentRecognition.suggestion=null;this.recognizedUsers=[];};l.prototype.done=function(){'use strict';this._sendWaterfallLogSignal(c('PhotosTaggingWaterfall').FINISH);};l.prototype.handleTokenAction=function(m,n){'use strict';var o=c('$')(this.photoKey),p=c('DOM').find(o,'.peopleIcon'),q=c('DOM').find(o,'.editablePhotoTagList'),r=c('DOM').find(p,'.count'),s=this.tokenizer.getTokens().length,t=n.info.suggestion?c('FaceboxSourceConstants').UPLOADER_SUGGEST:null;if(this._currentRecognition.box)this._currentRecognition.isTagged=!!s;c('CSS').conditionClass(p,'hasPeople',!!s);c('CSS').conditionClass(q,'hasPeople',!!s);c('DOM').setContent(r,s);if(m=='addToken'){this.saveTag(m,n,t);return;}else{this.removeTag(m,n);c('PersistentAlbumDataStore').removeTag(this.photoData.albumFBID,this.photoData.fbid,n.info.uid);c('Arbiter').inform('PhotoBulkEditTagger.TAG_REMOVED',{editor:this.root,fbid:this.photoData.fbid});}};l.prototype.useTaggingDataSource=function(m,n){'use strict';if(!this._needTaggingData)return;var o=this.tokenizer.getTypeahead();o.swapData(n);this.setNeedTaggingData(false);};l.prototype.getTaggerPositioningOrigin=function(){'use strict';return c('Vector').getElementPosition(this.root);};l.prototype.getRecognitionBoxCenter=function(m,n){'use strict';var o=c('Vector').getElementPosition(m).add(c('Vector').getElementDimensions(m).mul(.5)),p=c('Vector').getElementDimensions(this._currentRecognition.box),q=this.calcTaggerPosition(n,o,p.x,p.y);return {boxPos:o,boxDim:p,taggerPos:q};};l.prototype.setUpTagger=function(m,n,o,p,q){'use strict';this.calcClickPoint(m,o);q.setElementPosition(this.tagger);if(p)p.setElementDimensions(this.tagger);c('CSS').hide(c('DOM').find(n,'.clickToTagMessage'));this._sendWaterfallLogSignal(c('PhotosTaggingWaterfall').TAG_FACE);this.updateTypeaheadSuggestions();this.updateWithSuggestions();this.showTagger();this._tagging=true;};l.prototype.clickHandler=function(event){'use strict';var m=event.getTarget();if(c('Parent').byClass(m,'photoTagTypeahead'))return;if(this._hoverState){this._hoverState=false;this._tagging=true;return;}if(this.tagger){this.hideTagger();this.removeSuggestionFromTagger();this.handlers.release();}if(c('Parent').byClass(m,'photoContextualSelector')||c('Parent').byClass(m,'removePhotoButton'))return;var n=c('Parent').byClass(m,'editablePhotoImage');if(!n){var o=c('Parent').byClass(m,'peopleIcon');if(o)this.setupPhotoDataForTarget(o);return;}if(c('DOMQuery').scry(n,'.clickToTagMessage').length===0)return;this.setupPhotoDataForTarget(n);var p=c('DOM').find(n,'.scaledImage img'),q=null,r=null,s=null,t=c('Parent').byClass(m,'faceBox');if(!t)t=c('Parent').byClass(m,'recognitionBox');this._currentRecognition.box=t;if(this._currentRecognition.box&&c('CSS').shown(this._currentRecognition.box)){var u=this.getRecognitionBoxCenter(t,p);q=u.boxPos;r=u.boxDim;s=u.taggerPos;c('CSS').hide(this._currentRecognition.box);this._currentRecognition.isTagged=false;var v=this.getFaceboxSuggestionFromFaceboxElem(t);if(v){this._currentRecognition.suggestion=v;this.addSuggestionToTagger(t,v);this._sendFaceboxSuggestionLogSignal(v.getAttribute('data-id'),c('FaceboxSourceConstants').UPLOADER_SUGGEST);}else this.recognizedUsers=JSON.parse(t.getAttribute('data-recognizeduids'));}if(s===null){q=c('Vector').getEventPosition(event);s=this.calcTaggerPosition(p,q,k);}if(!s)return;this.setUpTagger(p,n,q,r,s);};l.prototype._mouseOverFacebox=function(m){'use strict';if(this._tagging)return;var n=m.image,o=m.facebox,p=this.getFaceboxSuggestionFromFaceboxElem(o);if(p){this._hoverState=true;this._currentRecognition.box=o;this._currentRecognition.suggestion=p;this.setupPhotoDataForTarget(n);this.addSuggestionToTagger(o,p);this._sendFaceboxSuggestionLogSignal(p.getAttribute('data-id'),c('FaceboxSourceConstants').UPLOADER_SUGGEST);this._sendWaterfallLogSignal(c('PhotosTaggingWaterfall').HOVER_TAG_FACE);var q=c('Vector').getElementPosition(o).add(c('Vector').getElementDimensions(o).mul(.5)),r=c('Vector').getElementDimensions(this._currentRecognition.box),s=this.calcTaggerPosition(n,q,r.x,r.y);this.calcClickPoint(n,q);s.setElementPosition(this.tagger);r.setElementDimensions(this.tagger);this.showTagger();}};l.prototype.fetchTaggingSuggestions=function(){'use strict';this.logUserActionEvent('sugg_fetch');new (c('AsyncRequest'))().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption('retries',1).setHandler(function(m){var n=m.getPayload();this.featuredSuggestions=n.featuredTaggees;this.friendSuggestions=n.friendTaggees;this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();};l.prototype.switchPhoto=function(m,n){'use strict';var o=c('ge')(n);o&&this.setupPhotoDataForTarget(o);this.hideTagger();};l.prototype.getImageByID=function(m){'use strict';return c('ge')('editablePhoto_'+m);};l.prototype.setupPhotoDataForTarget=function(m){'use strict';var n;if(m&&!c('CSS').hasClass(m,'editablePhoto')){n=c('Parent').byClass(m,'editablePhoto');}else n=m;if(!n){this.photoKey=null;this.photoData=null;return false;}var o=n.id;if(o===this.photoKey)return;this.photoKey=o;this.photoData=this.editor.getPhotoData(o);this.tokenizer.setTokenarea(c('DOM').find(n,'div.editablePhotoTagList'));};l.prototype.getPosition=function(){'use strict';return this.photoData.fbid;};l.prototype.tagsChangeHandler=function(m){'use strict';};l.prototype.removeTagByID=function(m,n,o){'use strict';this.hideTagger();this.setupPhotoDataForTarget(this.getImageByID(m));j.removeTagByID.call(this,m,n,o);};l.prototype.setupFaceboxSuggestionHandlers=function(m,n){'use strict';var o=c('DOM').find(n,"._570w"),p=c('DOM').find(n,"._570x");this.handlers.engage();this.handlers.addSubscriptions(c('Event').listen(o,'click',function(q){this.dismissFaceboxSuggestion(m.id.replace('face:',''),n.getAttribute('data-id'),this.photoData.owner,c('FaceboxSourceConstants').UPLOADER_DISMISS);this.removeSuggestionFromTagger();this.hideTagger();c('DOM').remove(this.getFaceboxSuggestionFromFaceboxElem(m));}.bind(this)),c('Event').listen(p,'click',function(q){var r=this.tokenizer.createToken({uid:n.getAttribute('data-id'),text:n.getAttribute('data-text'),suggestion:true});this.removeSuggestionFromTagger();c('CSS').hide(m);this.tokenizer.addToken(r);}.bind(this)));};Object.assign(l.prototype,{elemNames:{}});f.exports=l;}),null);
__d('PhotosBulkBackdateEditor',['Event','Arbiter','DOMQuery','Focus','Form'],(function a(b,c,d,e,f,g){var h={setup:function i(j,k){c('Event').listen(j,'click',function(){k.setContext(j);k.show();});var l=c('DOMQuery').find(k.getContent(),"^.photosBulkDatePicker .saveBackdatedTime");c('Event').listen(l,'click',function(){var m=c('Form').serialize(k.getContent()),n=m.backdated_date,o=parseInt(m.use_date_from_file,10)>0,p=c('DOMQuery').scry(k.getContent(),'#hide_from_newsfeed')[0],q=p&&p.checked;c('Arbiter').inform('PhotosBulkBackdateEditor.SAVED',{context:j,backdatedDate:n,hideFromNewsfeed:q,useDateFromFile:o});k.hide();c('Focus').set(j);});}};f.exports=h;}),null);
__d('PhotoBulkEditTokenizer',['DOM','Event','Input','Parent','Tokenizer','UserAgent_DEPRECATED','getObjectValues'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('Tokenizer'));i=h&&h.prototype;j.prototype.init=function(k,l,m,n){'use strict';this._tokenareaListeners={};i.init.call(this,k,l,m,n);this.inform('initialized');};j.prototype.initEvents=function(){'use strict';var k=c('UserAgent_DEPRECATED').firefox()<4?'keypress':'keydown';c('Event').listen(this.input,'paste',this.paste.bind(this));c('Event').listen(this.input,k,this.keydown.bind(this));};j.prototype.setTokenarea=function(k){'use strict';this.tokenarea=k;this.addTokenareaListener(k);this.reset();};j.prototype.addTokenareaListener=function(k){'use strict';if(this._tokenareaListeners[k.id])return;var l=this.handleEvents.bind(this);this._tokenareaListeners[k.id]=c('getObjectValues')(c('Event').listen(k,{click:l,keydown:l}));};j.prototype.handleEvents=function(event){'use strict';var k=c('Parent').byClass(event.getTarget(),'editablePhotoTagList');if(!k){return;}else if(this.tokenarea!==k){this.setTokenarea(k);this.inform('switchTarget',this.tokenarea.id);}return i.handleEvents.call(this,event);};j.prototype.reset=function(){'use strict';var k=this.getTokenElements().map(function(l){return {uid:c('DOM').scry(l,'input')[0].value,text:c('DOM').scry(l,'input')[1].value};});c('Input').reset(this.input);return i.reset.call(this,k);};j.prototype.updateTokenareaVisibility=function(){'use strict';return null;};j.prototype.insertToken=function(k){'use strict';c('DOM').prependContent(this.tokenarea,k.getElement());};function j(){'use strict';h.apply(this,arguments);}f.exports=j;}),null);
__d('ProgressiveDatepicker',['Arbiter','ArbiterMixin','CSS','DataStore','DOM','Event','Parent','getElementText','mixin','shield','Focus'],(function a(b,c,d,e,f,g){var h,i;function j(m){return new Date(m[0],m[1],m[2],m[3],m[4]);}function k(m,n){while(m.length)c('DOM').insertAfter(n,m.pop());}h=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function l(m,n){'use strict';i.constructor.call(this);this._root=m;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};this._dayOrderAscending=n.dayorderascending;var o=0;if(n.gmtoffset!==undefined)o=-new Date().getTimezoneOffset()-n.gmtoffset;this._mintime=n.mintime&&new Date(1000*n.mintime-o*60000);this._maxtime=n.maxtime&&new Date(1000*n.maxtime-o*60000);c('DataStore').set(m,'datepicker',this);c('DOM').scry(m,'select').forEach(function(p){c('Event').listen(p,'change',c('shield')(this._handleChange,this,p));var q=c('Parent').byClass(p,'period');c('Event').listen(p,'focus',c('CSS').addClass.bind(null,q,'periodFocus'));c('Event').listen(p,'blur',c('CSS').removeClass.bind(null,q,'periodFocus'));this._setMenuSelectionState(p);if(p.getAttribute('data-name')==='month')this._filterInvalidDates();}.bind(this));c('DOM').scry(m,'a.periodLabel').forEach(function(p){var q=c('Parent').byClass(p,'period');c('Event').listen(p,'click',function(){c('CSS').addClass(q,'periodSelected');c('CSS').addClass(q,'periodFocus');c('Focus').set(c('DOM').find(q,'select'));});});this._filterInvalidDates();this.inform('initialized',this,c('Arbiter').BEHAVIOR_STATE);}l.prototype.setDate=function(m,n,o,p,q){'use strict';this._addSavedPeriods();var r=l.PERIODS;for(var s=0;s<r.length;s++)this._setValueForPeriod(r[s],arguments[s]);this._filterInvalidDates();this.inform('changed');};l.prototype.setDateWithTimestamp=function(m){'use strict';var n=new Date(m);this.setDate(n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes());};l.prototype.isSet=function(){'use strict';var m=l.PERIODS;for(var n=0;n<m.length;n++)if(this._getValueForPeriod(m[n]))return true;return false;};l.prototype.getRoot=function(){'use strict';return this._root;};l.prototype.getValues=function(){'use strict';var m=l.PERIODS,n={};for(var o=0;o<m.length;o++){var p=this._getValueForPeriod(m[o]);if(p)n[m[o]]=p;}return n;};l.prototype.getDate=function(){'use strict';var m=this.getValues();return new Date(m.year||0,(m.month||1)-1,m.day||1,m.hour||0,m.minute||0);};l.prototype.getTimestamp=function(){'use strict';return Math.round(this.getDate().getTime()/1000);};l.prototype._setValueForPeriod=function(m,n){'use strict';var o=this._menuForPeriodName(m);if(!o)return;if(n===undefined)n='';var p=o.options;for(var q=0,r=p.length;q<r;q++)if(p[q].value==n){o.selectedIndex=q;break;}this._setMenuSelectionState(o);};l.prototype._getValueForPeriod=function(m){'use strict';var n=this._menuForPeriodName(m);return n&&n.options[n.selectedIndex].value;};l.prototype._handleChange=function(m){'use strict';this._setMenuSelectionState(m);this._filterInvalidDates();this.inform('changed');};l.prototype._setMenuSelectionState=function(m){'use strict';var n=c('Parent').byClass(m,'period');if(!n)return;if(c('CSS').hasClass(n,'periodRequired')){if(m.selectedIndex===0)m.selectedIndex=1;}else this._updateLabel(m);var o=m.getAttribute('data-name'),p=m.options[m.selectedIndex].value;c('CSS').conditionClass(n,'periodSelected',p);c('CSS').conditionClass(this._root,this._selectedClass(o),p);if(!p)this._resetMenu(l.PERIODS.indexOf(o)+1);};l.prototype._updateLabel=function(m){'use strict';var n=m.getAttribute('data-name'),o=m.options[0];if(!this._savedLabels[n])this._savedLabels[n]=c('getElementText')(o);if(m.selectedIndex===0){c('DOM').setContent(o,this._savedLabels[n]);}else c('DOM').setContent(o,'--');};l.prototype._daysInMonth=function(m,n){'use strict';return new Date(m||1999,n+1||1,0).getDate();};l.prototype._daysInCurrentMonth=function(){'use strict';return this._daysInMonth(this._getValueForPeriod('year'),this._getValueForPeriod('month')-1);};l.prototype._menuForPeriodName=function(m){'use strict';if(!this._menus[m])this._menus[m]=c('DOM').scry(this._root,'.'+m+'Menu')[0];return this._menus[m];};l.prototype._selectedClass=function(m){'use strict';return 'uiProgressiveDatepickerSelected-'+m;};l.prototype._resetMenu=function(m){'use strict';var n=l.PERIODS;for(;m<n.length;m++){var o=n[m],p=this._menuForPeriodName(o);if(!p)return;if(c('Parent').byClass(p,'periodRequired')){p.selectedIndex=1;}else{c('CSS').removeClass(c('Parent').byClass(p,'period'),'periodSelected');c('CSS').removeClass(this._root,this._selectedClass(o));p.selectedIndex=0;this._updateLabel(p);}}};l.prototype._addSavedPeriods=function(){'use strict';var m=l.PERIODS;for(var n=0;n<m.length;n++){var o=this._menuForPeriodName(m[n]);if(!o)return;this._savedPeriodsFront[n]||(this._savedPeriodsFront[n]=[]);this._savedPeriodsBack[n]||(this._savedPeriodsBack[n]=[]);var p=o.options[0],q=o.options[o.options.length-1];if(n===l.PERIODS.indexOf('hour')||n===l.PERIODS.indexOf('minute')||n===l.PERIODS.indexOf('day')&&this._dayOrderAscending){k(this._savedPeriodsFront[n],p);k(this._savedPeriodsBack[n],q);}else{k(this._savedPeriodsBack[n],p);k(this._savedPeriodsFront[n],q);}}};l.prototype._filterInvalidDates=function(){'use strict';this._addSavedPeriods();var m=l.PERIODS,n=this.getValues();for(var o=0;o<m.length;o++){var p=this._menuForPeriodName(m[o]);if(!p)return;this._savedPeriodsFront[o]||(this._savedPeriodsFront[o]=[]);this._savedPeriodsBack[o]||(this._savedPeriodsBack[o]=[]);for(var q=1;q<p.options.length;){var r=p.options[q],s=[o-1>=0?n[m[0]]:0,o-1>=1?n[m[1]]-1:0,o-1>=2?n[m[2]]:1,o-1>=3?n[m[3]]:0,o-1>=4?n[m[4]]:0];s[o]=r.value;if(o===l.PERIODS.indexOf('month'))s[o]=s[o]-1;var t=j(s),u=[o-1>=0?n[m[0]]:9001,o-1>=1?n[m[1]]-1:11,o-1>=2?n[m[2]]:this._daysInCurrentMonth(),o-1>=3?n[m[3]]:23,o-1>=4?n[m[4]]:59];u[o]=r.value;if(o===l.PERIODS.indexOf('month')){u[o]--;u[o+1]=this._daysInMonth(u[0],u[1]);}var v=j(u),w=t>this._maxtime,x=v<this._mintime,y=o===l.PERIODS.indexOf('day')&&r.value>this._daysInCurrentMonth();if(x||w||y){if(r.selected){r.selected=false;this._resetMenu(o);}c('DOM').remove(r);if(w||y){this._savedPeriodsBack[o].push(r);}else this._savedPeriodsFront[o].push(r);}else q++;}}};l.getInstance=function(m){'use strict';return m?c('DataStore').get(m,'datepicker'):null;};Object.assign(l,{PERIODS:['year','month','day','hour','minute']});f.exports=l;}),null);
__d('PhotosBulkEditablePhoto',['csx','cx','fbt','Arbiter','AsyncDialog','AsyncRequest','AsyncResponse','CSS','Dialog','DOM','Event','Focus','Form','Input','Parent','PhotosConst','PlaceUtils','ProgressiveDatepicker'],(function a(b,c,d,e,f,g,h,i,j){var k=null,l=null,m=false;function n(o,p,q,r,s,t,u){'use strict';this._root=o;this._mentionsTypeahead=p;this._placesTypeahead=q;this._photoData=r;this._hasOwnPlaceValue=!!q.getCore().getHiddenValue();var v=c('DOM').find(o,'.placesInput'),w=c('DOM').find(o,'.captionTextarea'),x=c('DOM').find(q.element,'.uiTypeaheadCloseButton');this._metadataInputs=c('DOM').find(o,'.metadataInputs');this._editorId=s;this._published=t;this._showMove=u;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated;this._listeners=[c('Event').listen(o,'click',this._handleClick.bind(this)),c('Event').listen(v,'focus',this._placesFocus.bind(this)),c('Event').listen(w,'focus',this._captionFocus.bind(this)),c('Event').listen(w,'blur',this._save.bind(this)),c('Event').listen(x,'click',function(){setTimeout(this._save.bind(this),0);}.bind(this)),c('Event').listen(o,'submit',function(){return false;})];this._previousSaveData=c('Form').serialize(this._root);var y=c('DOM').scry(this._root,'div.backdateInput .periodMenu');for(var z=0;z<y.length;z++){var aa=y[z];this._listeners.push(c('Event').listen(aa,'change',function(){return this._saveDate();}.bind(this)));}var ba=c('DOM').scry(this._root,"._2sfm").pop();if(ba){var ca=ba.getAttribute('data-direction');this._listeners.push(c('Event').listen(ba,'click',this._rotate.bind(this,ca)));}var da=c('DOM').scry(o,'.photoContextualSelector')[0];if(da){var ea=c('DOM').scry(da,'.moveAlbum')[0];ea&&this._listeners.push(c('Event').listen(ea,'click',this._move.bind(this)));var fa=c('DOM').scry(da,'.albumCover')[0];fa&&this._listeners.push(c('Event').listen(fa,'click',this._setAlbumCover.bind(this)));var ga=c('DOM').scry(da,'.removePhoto')[0];ga&&this._listeners.push(c('Event').listen(ga,'click',this.remove.bind(this)));}else{var ha=c('DOM').find(o,'.removePhotoButton');this._listeners.push(c('Event').listen(ha,'click',this.remove.bind(this)));}this._placesDataListener=[q.subscribe(['select','reset','render'],function(ia,ja){c('CSS').conditionClass(this._root,'focusedInput',ia=='render');if(ia=='render')return;if(ia=='reset'&&q.getCore().getHiddenValue())return;if(ja&&ja.selected){k=ja.selected;if(l==k.text){m=true;}else{l=k.text;m=false;}}else{k=null;l=null;m=false;}this._hasOwnPlaceValue=ia=='select';c('CSS').conditionClass(c('DOM').find(o,'.placeIcon'),'hasPlace',this._hasOwnPlaceValue);if(this._hasOwnPlaceValue)this._save();}.bind(this))];this._placesInputBlurListener=q.getCore().subscribe('blur',function(ia,ja){c('CSS').removeClass(this._root,'focusedInput');}.bind(this));c('Arbiter').inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this,c('Arbiter').BEHAVIOR_PERSISTENT);}n.prototype.getPhotoDataKey=function(){'use strict';return this._photoDataKey;};n.prototype.getPhotoData=function(){'use strict';return this._photoData;};n.prototype.getRoot=function(){'use strict';return this._root;};n.prototype.getDragHandle=function(){'use strict';return this.getRoot();};n.prototype.getRotateButtonType=function(){'use strict';return this._rotateButtonType;};n.prototype.swapData=function(o,p){'use strict';var q=this._mentionsTypeahead.getData(),r=this._placesTypeahead.getData();if(q!==o)this._mentionsTypeahead.swapData(o);if(r!==p){var s=this._placesTypeahead.getCore().getValue(),t=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(p);if(this.hasOwnPlaceValue())this._placesTypeahead.getCore().select({text:s,uid:t});}};n.prototype.hasOwnPlaceValue=function(){'use strict';return this._hasOwnPlaceValue;};n.prototype.setAlbumPlace=function(o,p){'use strict';this._hasOwnPlaceValue=false;var q=this._placesTypeahead.getCore();c('CSS').conditionClass(c('DOM').find(this._root,'.placeIcon'),'hasPlace',!!o);if(o){q.select(o);}else q.reset();if(!p)this._save();};n.prototype.addPlaceSelectHandler=function(o){'use strict';this._placesDataListener.push(this._placesTypeahead.subscribe('select',o));};n.prototype.mapEventNameToNamespace=function(o){'use strict';return o+(this._editorId?'/'+this._editorId:'');};n.prototype.setDate=function(o,p){'use strict';if(this._hasExistingDateValue)return;var q=!o,r=o;if(q){if(!this._hasTimeTaken)return;r=Math.round(this._photoData.timeTaken/600)*600*1000;}var s=c('DOM').find(this.getRoot(),'.uiProgressiveDatepicker'),t=c('ProgressiveDatepicker').getInstance(s);t.setDateWithTimestamp(r);c('CSS').conditionClass(c('DOM').find(this._root,'.dateIcon'),'hasDate',!!r);if(q)this._saveDate(p);};n.prototype._doRemove=function(){'use strict';c('DOM').remove(this._root);this._unsubscribeAll();c('Arbiter').inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this);};n.prototype._unsubscribeAll=function(){'use strict';this._listeners.forEach(function(o){o.remove();});this._listeners=[];this._placesDataListener.forEach(function(o){this._placesTypeahead.unsubscribe(o);}.bind(this));this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener);};n.prototype._handleClick=function(o){'use strict';var p=o.getTarget();if(c('Parent').byClass(p,'confirmPhotoBackdate')){this._saveDate();return;}if(!c('Parent').byClass(p,'metaIcon'))return;c('CSS').addClass(this._root,'showControls');if(c('Parent').byClass(p,'placeIcon')){this._showMetadataInput('place');c('Focus').set(this._placesTypeahead.getCore().getElement());}else if(c('Parent').byClass(p,'dateIcon')){this._showMetadataInput('date');}else if(c('Parent').byClass(p,'peopleIcon')){c('Arbiter').inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED'),this);this._showMetadataInput('people');}else c('CSS').removeClass(this._root,'showControls');};n.prototype.hideMetadataInputs=function(){'use strict';this._showMetadataInput();};n.prototype._showMetadataInput=function(o){'use strict';['people','date','place'].forEach(function(p){c('CSS').conditionClass(this._metadataInputs,p,o==p);}.bind(this));};n.prototype._captionFocus=function(o){'use strict';this.hideMetadataInputs();c('CSS').addClass(this._root,'focusedInput');};n.prototype.remove=function(){'use strict';var o={fbid:this._photoData.fbid,version:c('PhotosConst').BULK_EDITOR,confirmed:true};new (c('Dialog'))().setTitle(j._("Usu\u0144 zdj\u0119cie")).setBody(j._("Czy na pewno chcesz usun\u0105\u0107 to zdj\u0119cie?")).setButtons(c('Dialog').OK_AND_CANCEL).setModal(true).setHandler(function(){c('CSS').addClass(this._root,'editablePhotoWillBeRemoved');new (c('AsyncRequest'))().setURI('/ajax/photos/photo/delete/dialog.php').setData(o).setHandler(function(p){if(p.getPayload().success){this._doRemove();}else c('CSS').removeClass(this._root,'editablePhotoWillBeRemoved');}.bind(this)).setErrorHandler(function(p){c('CSS').removeClass(this._root,'editablePhotoWillBeRemoved');c('AsyncResponse').defaultErrorHandler(p);}.bind(this)).send();}.bind(this)).show();};n.prototype._setAlbumCover=function(){'use strict';var o={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},p=new (c('AsyncRequest'))().setURI('/ajax/photos/album/setcover/').setData(o).setAllowCrossPageTransition(false);c('AsyncDialog').send(p);};n.prototype._move=function(){'use strict';var o={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},p=new (c('AsyncRequest'))().setURI('/ajax/photos/photo/move/dialog.php').setData(o).setAllowCrossPageTransition(false);c('AsyncDialog').send(p);};n.prototype._timeclose=function(o,p){'use strict';o=o||0;p=p||0;return Math.abs(o-p)<43200;};n.prototype._placesFocus=function(o){'use strict';c('CSS').addClass(this._root,'focusedInput');var p=c('DOM').scry(this._root,'input.latitude')[0],q=c('DOM').scry(this._root,'input.longitude')[0],r=c('DOM').scry(this._root,'input.takentime')[0],s=r?c('Input').getValue(r):null,t=this._placesTypeahead.getData(),u=t.getBootstrapData(),v={};if(p&&q){v={latitude:c('Input').getValue(p),longitude:c('Input').getValue(q),proximity_boost:'true',city_id:null,search_time:s};t.setQueryData(v,false);if(!c('PlaceUtils').placesClose(u.latitude,u.longitude,v.latitude,v.longitude)||!this._timeclose(u.search_time,v.search_time))t.setBootstrapData(v,false).setBootstrapEndpoint(t.getQueryEndpoint());}else{v={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:s};if(k)if(k.city_id){v.city_id=k.city_id;}else if(k.latitude&&k.longitude){v.latitude=k.latitude;v.longitude=k.longitude;}t.setQueryData(v,false);if(!m){t.setBootstrapData(v).resetBootstrapEndpoint(true);}else if(!c('PlaceUtils').placesClose(u.latitude,u.longitude,v.latitude,v.longitude)||!this._timeclose(u.search_time,v.search_time))t.setBootstrapData(v,false).resetBootstrapEndpoint();}};n.prototype._saveDate=function(o){'use strict';var p=c('DOM').find(this._root,'div.backdateInput'),q=c('Form').serialize(p);q.source=this.source;q.fbid=this._photoData.fbid;q.version=c('PhotosConst').BULK_EDITOR;q.bulk=!!o;c('CSS').addClass(p,'backdating');new (c('AsyncRequest'))().setURI('/ajax/photos/photo/backdate/').setData(q).setRelativeTo(this._root).send();};n.prototype._save=function(){'use strict';c('CSS').removeClass(this._root,'focusedInput');var o=c('Form').serialize(this._root);if(this._previousSaveData){var p=false;for(var q in o){if(q!=='caption'&&q!=='location'&&q!=='location_data')continue;if(o[q]!==this._previousSaveData[q]){p=true;this._previousSaveData[q]=o[q];}}if(!p)return;}o.source=this.source;o.bulk=!this._hasOwnPlaceValue;new (c('AsyncRequest'))().setURI('/ajax/photos/metadata/save/').setData(o).setAllowCrossPageTransition(true).send();};n.prototype._setLoadingIndicator=function(o){'use strict';c('CSS').conditionClass(this._root,"_2sfl",o);};n.prototype._rotate=function(o){'use strict';var p={fbid:this._photoData.fbid,cs_ver:c('PhotosConst').BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};p[o]=1;this._setLoadingIndicator(true);new (c('AsyncRequest'))('/ajax/photos/photo/rotate/').setData(p).setHandler(function(q){c('DOM').replace(this._root,q.getPayload());this._unsubscribeAll();c('Arbiter').inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED'),this);}.bind(this)).setFinallyHandler(function(){this._setLoadingIndicator(false);}.bind(this)).setMethod('POST').send();return false;};f.exports=n;}),null);
__d('PhotosBulkEditablePhotoPlaceholder',['csx','CSS','DOM','Event','mixInEventEmitter'],(function a(b,c,d,e,f,g,h){function i(j,k,l){'use strict';this._root=j;this._progressBar=k;this._uploadID=l;this._initAndGetGatedButton("._3273",'cancelButtonClicked');this._retryButton=this._initAndGetGatedButton("._3p03",'retryButtonClicked');this._errorOkayButton=this._initAndGetGatedButton("._8qx",'dismissPlaceholder');this._errorCloseButton=this._initAndGetGatedButton("._8qy",'dismissPlaceholder');}i.prototype._initAndGetGatedButton=function(j,k){'use strict';var l=c('DOM').scry(this._root,j);if(l.length){l=l[0];c('Event').listen(l,'click',function(){return this.emit(k,this._uploadID);}.bind(this));return l;}};i.prototype.getProgressBar=function(){'use strict';return this._progressBar;};i.prototype.getRoot=function(){'use strict';return this._root;};i.prototype.hide=function(){'use strict';c('CSS').hide(this._root);};i.prototype.show=function(){'use strict';c('CSS').show(this._root);};i.prototype.showRetryButton=function(){'use strict';this._retryButton&&c('CSS').show(this._retryButton);};i.prototype.showErrorOkayButton=function(){'use strict';this._errorOkayButton&&c('CSS').show(this._errorOkayButton);};i.prototype.showErrorCloseButton=function(){'use strict';this._errorCloseButton&&c('CSS').show(this._errorCloseButton);};c('mixInEventEmitter')(i,{cancelButtonClicked:true,retryButtonClicked:true,dismissPlaceholder:true});f.exports=i;}),null);
__d("XPhotoBatchEditLocationController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/photos\/edit\/batch\/location\/",{});}),null);
__d('PhotosBulkEditor',['xuiglyph','cx','ActorURI','Arbiter','AsyncRequest','Button','CSS','DOM','Event','PageTransitions','Parent','PhotosConst','SortableGroup','XPhotoBatchEditLocationController','mapObject','createIxElement','emptyFunction'],(function a(b,c,d,e,f,g,h,i){var j={ASCENDING:'ascending',DESCENDING:'descending',MANUAL:'manual'},k={ascending:h({name:'triangle-up',shade:'dark',size:'small'}),descending:h({name:'triangle-down',shade:'dark',size:'small'})};function l(m,n,o,p,q,r,s,t,u){'use strict';this.source=m;if(!n)return;this._root=n;this._reorderButton=c('DOM').scry(this._root.parentNode,'button.reorderButton').pop();this._id=n.getAttribute('id');this._ownerID=u;this._photos={};this._tagger=null;this._options=s;this._isNamespaced=t;this._placeholder=q;this._waitingTemplate=r;this._mentionsData=o;this._placesData=p;this._albumPlace=null;this._userDate=null;this._useDateFromFile=false;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=this.source===c('PhotosConst').FLASH_UPLOADER;this._coverPhotoSortingID=null;if(s.canReorder)this._initSorting(s.autosaveReorder);var v=[c('Arbiter').subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this._registerPhoto.bind(this)),c('Arbiter').subscribe([this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED')],function(w,x){if(this._sortableGroup){var y=x.getPhotoData().fbid;this._sortableGroup.removeSortable(y);}delete this._photos[x.getPhotoDataKey()];}.bind(this)),c('Arbiter').subscribe('PhotosBulkEditor.AUTO_ORDER',this._autoOrder.bind(this)),c('Arbiter').subscribe('PhotosBulkBackdateEditor.SAVED',function(w,x){this._useDateFromFile=x.useDateFromFile;this._userDate=x.backdatedDate;this._setDate();}.bind(this)),c('Arbiter').subscribe(['PhotoAlbumPlacesTypeahead.SELECTED_PLACE','PhotoAlbumPlacesTypeahead.EXIST_PLACE','PhotoAlbumPlacesTypeahead.RESET_PLACE'],this._setPlace.bind(this)),c('Arbiter').subscribe('PhotosBulkEditablePhoto.MOVED',function(w,x){if(this.getPhotoData(x))this._photos[x]._doRemove();}.bind(this))];c('Event').listen(this._root,'click',function(w){var x=c('Parent').byClass(w.getTarget(),'editablePhoto'),y=this._photos;c('DOM').scry(this._root,'.showControls').forEach(function(z){if(x!==z){c('CSS').removeClass(z,'showControls');y[z.id].hideMetadataInputs();}});}.bind(this));c('PageTransitions').registerHandler(function(){v.forEach(function(w){w.unsubscribe();});if(this._tagger)this._tagger.done();}.bind(this));}l.prototype.init=function(m,n,o,p,q,r){'use strict';l.call(this,this.source,m,n,o,p,q,r);};l.prototype.getRoot=function(){'use strict';return this._root;};l.prototype.getSourceString=function(){'use strict';if(this.source===c('PhotosConst').BULK_EDITOR){return 'bulk_editor';}else if(this.source===c('PhotosConst').FLASH_UPLOADER){return 'flash_uploader';}else return null;};l.prototype.isNamespaced=function(){'use strict';return this._isNamespaced;};l.prototype.getVersionConst=function(){'use strict';return this.source;};l.prototype.getViewerSource=function(){'use strict';return null;};l.prototype.getViewerSet=function(){'use strict';return null;};l.prototype.registerTagger=function(m){'use strict';this._tagger=m;};l.prototype.needTaggingData=function(){'use strict';return this._tagger&&this._tagger.needTaggingData();};l.prototype.getPhotoData=function(m){'use strict';var n=this._photos[m];if(n)return n.getPhotoData();return {};};l.prototype.getPlaceholder=function(){'use strict';return this._placeholder;};l.prototype.getWaitingTemplate=function(){'use strict';return this._waitingTemplate;};l.prototype.addFaceboxes=function(m){'use strict';this._tagger&&this._tagger.addFaceboxes(m);};l.prototype.mapEventNameToNamespace=function(m){'use strict';return m+(this._isNamespaced?'/'+this._id:'');};l.prototype._registerPhoto=function(event,m){'use strict';this._setSortMode(j.MANUAL);this._photos[m.getPhotoDataKey()]=m;m.source=this.source;var n=m.getPhotoData(),o=n.fbid;if(this._sortableGroup)this._sortableGroup.addSortable(o,m.getRoot(),m.getDragHandle());m.swapData(this._mentionsData,this._placesData);if(this._sortableGroup)m.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(o);}.bind(this));if(this._albumPlace&&!m.hasOwnPlaceValue())m.setAlbumPlace(this._albumPlace);if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];};l.prototype._recoverPhotos=function(m){'use strict';var n=this._photos;for(var o in n){var p=n[o];this._tagger.recoverPhoto(p);c('CSS').addClass(p.getRoot(),'showRecognitionBoxes');var q=c('DOM').find(p.getRoot(),'div.uiScaledImageContainer.scaledImage');this.addFaceboxes(q);}};l.prototype._initSorting=function(m){'use strict';this._setSortMode(j.MANUAL);this._dropCallback=function(n,o,p){var q=this._photos[o.id].getPhotoData(),r={order:this._sortableGroup.getOrder(),owner:q.owner};if(m){var s;if(q.set){r.set=q.set;s='/ajax/photos/sets/static/reorder.php';}else{r.album_fbid=q.albumFBID;s='/ajax/photos/reorder.php';}new (c('AsyncRequest'))(s).setData(r).send();}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==r.order[0]){var t=this._photos[this._sortableGroup.sortables[r.order[0]].id];if(t)this._makeAlbumCover(t);this._coverPhotoSortingID=r.order[0];}if(!p)this._setSortMode(j.MANUAL);}.bind(this);this._sortableGroup=new (c('SortableGroup'))().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){c('Arbiter').inform(this.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'));}.bind(this));};l.prototype._compare=function(m,n){'use strict';switch(this._sortMode){case j.MANUAL:return this._orderLookup[m.fbid]<this._orderLookup[n.fbid];case j.ASCENDING:return m.timeTaken<n.timeTaken;case j.DESCENDING:return m.timeTaken>n.timeTaken;default:throw new Error('Invalid sort mode');}};l.prototype._setSortMode=function(m){'use strict';if(!this._reorderButton)return;this._sortMode=m;var n=null,o=m!==j.MANUAL;if(o){n=c('createIxElement')(k[m]);c('CSS').addClass(n,"_3-8_");}c('Button').setDepressed(this._reorderButton,o);c('Button').setIcon(this._reorderButton,n);};l.prototype._autoOrder=function(){'use strict';switch(this._sortMode){case j.MANUAL:var m,n,o=this.getOrder();this._orderLookup={};for(n=0;n<o.length;n++){m=o[n];this._orderLookup[m]=n;}this._setSortMode(j.ASCENDING);break;case j.ASCENDING:this._setSortMode(j.DESCENDING);break;case j.DESCENDING:this._setSortMode(j.MANUAL);break;default:throw new Error('Invalid sort mode');}var p=this._sortableGroup.getOrder().map(function(x){return this._photos['editablePhoto_'+x].getPhotoData();}.bind(this));this._sortableGroup.setDropCallback(c('emptyFunction'));var q,r,s;for(q=0;q<p.length;q++){r=q;for(s=q+1;s<p.length;s++)if(this._compare(p[s],p[r]))r=s;if(q!==r){var t=p[r].fbid,u=p[q].fbid;this._sortableGroup.dragOverHandler(u,t);this._sortableGroup.dropHandler(t);p.splice(q,0,p.splice(r,1)[0]);}}var v=Object.keys(this._photos)[0],w=this._photos[v];this._dropCallback(w.getPhotoData().fbid,w.getRoot(),true);this._sortableGroup.setDropCallback(this._dropCallback);};l.prototype._saveCurrentOrder=function(){'use strict';if(this._photos.length===0)return;var m=this._sortableGroup.getOrder()[0],n=this._photos['editablePhoto_'+m]||this._photos['photoContainer_'+m];if(!n)return;var o=n.getPhotoData();if(!o.albumFBID)return;var p={order:this._sortableGroup.getOrder(),owner:o.owner,album_fbid:o.albumFBID};new (c('AsyncRequest'))('/ajax/photos/reorder.php').setData(p).send();};l.prototype._setPlace=function(event,m){'use strict';this._albumPlace=m||null;var n=this._options.batchUpdateLocation,o=[];c('mapObject')(this._photos,function(q,r){if(q.hasOwnPlaceValue())return;q.setAlbumPlace(this._albumPlace,n);if(n)o.push(q.getPhotoData().fbid);},this);if(n){var p=c('XPhotoBatchEditLocationController').getURIBuilder().getURI();if(this._ownerID)p=c('ActorURI').create(p,this._ownerID);new (c('AsyncRequest'))(p).setData({photo_ids:o,location:this._albumPlace?this._albumPlace.text:'',location_data:this._albumPlace?this._albumPlace.uid:0}).send();}};l.prototype._setDate=function(){'use strict';var m='',n=null,o;for(var p in this._photos){o=this._photos[p];if(!this._useDateFromFile){m=this._userDate.month+'/'+this._userDate.day+'/'+this._userDate.year;n=new Date(m).getTime();}o.setDate(n,true);}};l.prototype._showAlbumCoverSet=function(m){'use strict';if(this._albumCover)c('CSS').removeClass(this._albumCover,"checked");var n=c('DOM').find(m.getRoot(),'.albumCover');c('CSS').addClass(n,"checked");this._albumCover=n;};l.prototype._makeAlbumCover=function(m){'use strict';new (c('AsyncRequest'))().setURI('/ajax/photos/album/setcover').setData(m.getPhotoData()).send();};l.prototype.getOrder=function(){'use strict';if(this._sortableGroup){return this._sortableGroup.getOrder();}else return [];};l.prototype.hasOrder=function(){'use strict';return !!this._sortableGroup;};f.exports=l;}),null);
__d('PhotosBulkHeader',['fbt','Arbiter','AsyncRequest','DOM','Event','Form','Run','areJSONRepresentationsEqual','goURI'],(function a(b,c,d,e,f,g,h){function i(j,k,l,m){'use strict';this._form=j;this._isAlbum=k;this._editable=l;this._audience=m;this._backdatedTime=null;this._initialData=null;c('Arbiter').subscribe('PhotosBulkBackdateEditor.SAVED',function(n,o){if(!c('DOM').contains(this._form.getRoot(),o.context))return;this._backdatedTime=o.backdatedDate;}.bind(this));c('Run').onBeforeUnload(function(){if(this.isDataDirty())return h._("Niekt\u00f3re zmiany nie zosta\u0142y zapisane. Czy chcesz zapisa\u0107 je teraz?");return false;}.bind(this));this._initialData=this.getSerializedData();}i.prototype.getSerializedData=function(){'use strict';var j=c('Form').serialize(this._form.getRoot());if(this._backdatedTime)j.backTime=this._backdatedTime;return j;};i.prototype.isDataDirty=function(){'use strict';return !c('areJSONRepresentationsEqual')(this._initialData,this.getSerializedData());};i.prototype.save=function(j){'use strict';if(!this._editable)return j.call();if(this._audience&&this._audience.removeHiddenPrivacyWidget)this._audience.removeHiddenPrivacyWidget();var k=this._isAlbum?'/ajax/photos/album/edit':'/ajax/photos/sets/edit',l=c('Form').serialize(this._form.getRoot());if(this._backdatedTime)l.backdated_time=this._backdatedTime;new (c('AsyncRequest'))(k).setData(l).setMethod('POST').setHandler(function(){this._initialData=this.getSerializedData();j();}.bind(this)).send();};i.doneButtonSaveHandler=function(j,k,l){'use strict';var m=j.save.bind(j,function(){c('goURI')(k,true);return true;});j._listeners=[c('Event').listen(l,'click',m)];};f.exports=i;}),null);
__d('TagTypeaheadView',['AsyncRequest','ContextualTypeaheadView','CSS','DOM','Parent','FamilyTaggingConfig'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('ContextualTypeaheadView'));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this,k,l);this.hintText=l.hintText;this.userEd=l.userEd;this.origAutoSelect=l.autoSelect;this.setSuggestions(l.suggestions);}j.prototype.init=function(){'use strict';c('CSS').addClass(this.element,'uiTagTypeaheadView');i.init.call(this);};j.prototype.buildResults=function(k){'use strict';if(!this.value&&this.hintText)k.unshift({subtext:this.hintText,type:'hintText'});if(this.userEd){new (c('AsyncRequest'))().setURI('/ajax/fof/user_education.php').setData({increment:1}).send();k.unshift({subtext:this.userEd,type:'userEdText'});}if(c('FamilyTaggingConfig').gk){var l=[],m=[];for(var n=0;n<k.length;n++)if(k[n].type!=='family_tags'&&k[n].index!=-1000&&k[n].type!=='hintText'){l.push(k[n]);}else m.push(k[n]);k=m.concat(l);i.updateResults.call(this,k);}var o=i.buildResults.call(this,k);if(this.userEd)k.shift();if(!this.value)k.shift();return o;};j.prototype.show=function(){'use strict';var k=c('DOM').scry(this.context,'.typeaheadBackdrop');if(k.length>0)c('CSS').addClass(k[0],'resultsPresent');return i.show.call(this);};j.prototype.hide=function(){'use strict';var k=c('DOM').scry(this.context,'.typeaheadBackdrop');if(k.length>0)c('CSS').removeClass(k[0],'resultsPresent');return i.hide.call(this);};j.prototype.render=function(k,l,m){'use strict';this.autoSelect=this.origAutoSelect&&k.length;this.disableAutoSelect=k.length===0;l=l.concat(this.getAdditionalResults());i.render.call(this,k,l,m);};j.prototype.getItems=function(){'use strict';var k=i.getItems.call(this);if(!this.value)k.shift();if(this.userEd)k.shift();return k;};j.prototype.getSuggestions=function(){'use strict';return this.suggestions;};j.prototype.setSuggestions=function(k){'use strict';this.suggestions=k?k.map(String):[];this.visible=!!this.suggestions.length;};j.prototype.addSuggestion=function(k){'use strict';this.suggestions.unshift(k);};j.prototype.addTypeaheadFlip=function(k){'use strict';c('CSS').addClass(this.element,k);};j.prototype.removeTypeaheadFlip=function(k){'use strict';c('CSS').removeClass(this.element,k);};j.prototype.getContext=function(){'use strict';var k=c('Parent').byClass(this.element,'typeaheadContainer');if(k){return k;}else return i.getContext.call(this);};j.prototype.getAdditionalResults=function(){'use strict';return [];};f.exports=j;}),null);
__d('PlacesTypeaheadBehavior',['CSS','DOM'],(function a(b,c,d,e,f,g){var h={init:function i(j,k){j.subscribe(['reset','select','highlight'],function(l,m){if(l==='highlight'&&m.index!==-1&&m.selected.type!='freeform'&&m.selected.map&&!m.selected.changeCity){c('DOM').setContent(k,m.selected.map);c('CSS').show(k);}else c('CSS').hide(k);});}};f.exports=h;}),null);
__d('NoTrucatingCompactTypeaheadRenderer',['CompactTypeaheadRenderer'],(function a(b,c,d,e,f,g){function h(i,j){return c('CompactTypeaheadRenderer')(i,j);}h.className='noTrucating compact';f.exports=h;}),null);
__d('DisablePlatformButton',['ge','CSS','Event'],(function a(b,c,d,e,f,g){var h=false,i={init:function j(k){for(var l=0;l<k.length;l++){var m=c('ge')(k[l]);c('Event').listen(m,'click',function(n){if(h){return false;}else{h=true;for(var o=0;o<k.length;o++)c('CSS').addClass(k[o],'uiButtonDisabled');}});}}};f.exports=i;}),null);
__d('FreeformTokenizerBehavior',['Event','Input','Keys'],(function a(b,c,d,e,f,g){function h(i,j){var k=j.matcher&&new RegExp(j.matcher,'i'),l=j.splitter&&new RegExp(j.splitter),m=j.tokenize_on_blur!==false,n=j.tokenize_on_paste!==false,o=j.split_on_check===true,p=j.select_on_comma!==false,q=j.select_on_space===true,r=j.never_submit===true;function s(event){var t=c('Input').getValue(i.getInput()).trim();if(l&&event&&event.type=='paste'){t=t.split(l);}else if(l&&o){t=t.split(l);}else t=[t];var u=false;for(var v=0;v<t.length;v++){var w=t[v].trim();if(w&&(!k||k.test(w))){var x={uid:w,text:w,freeform:true};i.addToken(i.createToken(x));u=true;}}if(event&&u){i.getTypeahead().getCore().afterSelect();event.kill();}}i.subscribe('keydown',function(t,u){var event=u.event,v=c('Event').getKeyCode(event);if(v==c('Keys').RETURN||p&&v==c('Keys').COMMA||q&&v==c('Keys').SPACE){var w=i.getTypeahead().getView();if(w.getSelection()){w.select();event.kill();}else s(event);}if(v==c('Keys').RETURN&&r)event.kill();});i.subscribe('paste',function(t,u){if(n)setTimeout(s.bind(null,u.event),20);});i.subscribe('blur',function(t,u){if(m)s();i.getTypeahead().getCore().reset();});}f.exports=h;}),null);
__d('TypeaheadHintText',['emptyFunction'],(function a(b,c,d,e,f,g){function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';this._typeahead.getCore().resetOnKeyup=false;};Object.assign(h.prototype,{disable:c('emptyFunction')});f.exports=h;}),null);
__d('legacy:HintTextTypeaheadBehavior',['TypeaheadHintText'],(function a(b,c,d,e,f,g){if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.hintText=function(h){h.enableBehavior(c('TypeaheadHintText'));};}),3);
__d('legacy:ShowResultsOnFocusTypeaheadBehavior',['TypeaheadShowResultsOnFocus'],(function a(b,c,d,e,f,g){if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.showResultsOnFocus=function(h){h.enableBehavior(c('TypeaheadShowResultsOnFocus'));};}),3);